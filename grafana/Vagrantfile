Vagrant.configure("2") do |config|
  # Disable box update checks to speed up startup
  config.vm.box_check_update = false

  # Client VM - CentOS 7
  config.vm.define "client01" do |client|
    client.vm.box = "centos/7"
    client.vm.hostname = "client01"
    client.vm.network "private_network", ip: "192.168.56.20"
    client.vm.provider "virtualbox" do |vb|
      vb.memory = "1024"
      vb.cpus = 1
    end
    # Basic provisioning for client nodes
    client.vm.provision "shell", inline: <<-SHELL
      echo "192.168.56.21 otel" | sudo tee -a /etc/hosts
      sudo systemctl enable sshd
      sudo systemctl start sshd
    SHELL
  end

  # OTEL Collector VM - AlmaLinux 9
  config.vm.define "otel" do |otel|
    otel.vm.box = "almalinux/9"
    otel.vm.hostname = "otel"
    otel.vm.network "private_network", ip: "192.168.56.21"
    otel.vm.provider "virtualbox" do |vb|
      vb.memory = "2048"
      vb.cpus = 1
    end
    # Provision the control node with necessary packages
    otel.vm.provision "shell", inline: <<-SHELL
      echo "192.168.56.20 client01" | sudo tee -a /etc/hosts
      echo "Installing Ansible on OTEL node..."
      sudo dnf install -y epel-release
    SHELL
  end
end
